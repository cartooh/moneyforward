# upsert_to_excel テスト項目

## 基本機能テスト
- **新規作成**: Excelファイルが存在しない場合、DataFrameを新規に書き込み、ヘッダーとデータが正しく保存される。
- **再取得一致**: 同じDataFrameで再度実行した場合、ファイルに変更がない（差分なし）。

## 差分更新テスト
- **変更行更新**: 既存Excelの一部の値を手動変更後、再実行で変更が元に戻る（差分更新）。
- **新規行追加**: DataFrameに新しい行を追加し、再実行で既存行は変更なし、新規行が追加される。
- **行削除対応**: Excelから行を削除後、再実行でシートが再書き込みされ、最後の行に削除した行が復元される。
- **新規列追加**: DataFrameに新しい列を追加し、再実行でシートが再書き込みされ、新しい列が含まれる。
- **列削除対応**: Excelから列を削除後、再実行でシートが再書き込みされ、最後列に削除した列が復元される。

## エッジケーステスト
- **ユニークインデックス列欠損**: unique_index_labelが指定されているが、Excelファイルにその列が存在しない場合、エラー。
- **空DataFrame**: dfが空の場合、エラー。
- **列順序変更**: DataFrameの列順序が異なる場合、再書き込み。
- **欠損列**: 既存Excelにあった列が新しいDataFrameにない場合、再書き込み。
- **組み合わせ**: 新規行 + 新規列、変更行 + 列削除など。

## エラーハンドリングテスト
- **PermissionError**: ファイルが開いている場合、リトライとユーザー入力。 (テスト未実施: 自動テスト環境でファイルロックを再現しにくいため)
- **シート不存在**: 指定シートがない場合、新規作成。